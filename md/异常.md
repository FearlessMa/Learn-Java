# å¼‚å¸¸

## å¼‚å¸¸çš„å¤„ç†

* å¯¼è‡´ç¨‹åºä¸­æ–­æ‰§è¡Œçš„ä¸€ç§æŒ‡ä»¤æµã€‚

* ä¸ºäº†ä¿è¯ç¨‹åºå‡ºç°éè‡´å‘½é”™è¯¯ä¹‹åï¼Œç¨‹åºä¾ç„¶å¯ä»¥æ­£å¸¸æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œä»¥ä¿è¯ç¨‹åºçš„é¡ºåˆ©æ‰§è¡Œã€‚

### javaä¸­å¼‚å¸¸å¤„ç†

* å…³é”®å­—ï¼š tryã€catchã€finally

* åŸºæœ¬å¤„ç†ç»“æ„

```java
try{
    //å¯èƒ½å‡ºç°å¼‚å¸¸çš„ç¨‹åºä»£ç 
}catch(){//å¼‚å¸¸ç±»å‹ å¼‚å¸¸å¯¹è±¡
    //å¼‚å¸¸å¤„ç†
}catch(){

}finally{
    // ä¸ç®¡å¼‚å¸¸æ˜¯å¦å¤„ç†éƒ½è¦æ‰§è¡Œ
}

```

* å¸¸ç”¨ç»„åˆï¼š try...catchã€try...catch...finallyã€ try...finally

* ğŸŒ°

```java
// å¼‚å¸¸ä»£ç 
public class JavaDemo18 {
    public static void main(String[] args) {
        System.out.println("ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ");
        System.out.println("ã€2ã€‘è®¡ç®—10/2" + (10 / 0));
        System.out.println("ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ");

            // ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ
            // Exception in thread "main" java.lang.ArithmeticException: / by zero
            //     at JavaDemo18.main(JavaDemo18.java:4)
    }
}
```

```java
public class JavaDemo18 {
    public static void main(String[] args) {
        System.out.println("ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ");
        try{
            System.out.println("ã€2ã€‘è®¡ç®—10/2=" + (10 / 0));
        }catch(ArithmeticException e){
            System.out.println(e);
        }finally{
            System.out.println("æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ");
        }
        System.out.println("ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ");
        // ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ
        // java.lang.ArithmeticException: / by zero
        // æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ
        // ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ
    }
}
```

* è·å–å®Œæ•´å¼‚å¸¸ä¿¡æ¯
    * printStackTrace()

```java
public class JavaDemo18 {
    public static void main(String[] args) {
        System.out.println("ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ");
        try{
            System.out.println("ã€2ã€‘è®¡ç®—10/2=" + (10 / 0));
        }catch(ArithmeticException e){
            e.printStackTrace();//è·å–å®Œæˆçš„å¼‚å¸¸ä¿¡æ¯
        }finally{
            System.out.println("æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ");
        }
        System.out.println("ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ");
        // ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ
        // java.lang.ArithmeticException: / by zero
        // at JavaDemo18.main(JavaDemo18.java:5)
        // æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ
        // ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ
    }
}
```

### å¤„ç†å¤šä¸ªå¼‚å¸¸

* åœ¨ç¨‹åºä¸­å¯èƒ½äº§ç”Ÿå¤šä¸ªå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªcatchè¿›è¡Œå¼‚å¸¸çš„æ•è·ã€‚

* å³ä½¿æœ‰äº†å¼‚å¸¸å¤„ç†ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰è¿›è¡Œæ­£ç¡®çš„å¼‚å¸¸å¤„ç†ï¼Œé‚£ä¹ˆç¨‹åºä¹Ÿä¼šå¯¼è‡´ä¸­æ–­ã€‚(finallyçš„ä»£ç ä¾ç„¶æ‰§è¡Œ)

### å¼‚å¸¸å¤„ç†æµç¨‹

* å¼‚å¸¸äº§ç”Ÿä¹‹åç¨‹åºåšäº†å“ªäº›å¤„ç†

![](../img/å¼‚å¸¸.png)

* 1ã€åœ¨ç¨‹åºè¿è¡Œä¸­æ‰ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œä¸€æ—¦åœ¨ç¨‹åºä¹‹ä¸­äº§ç”Ÿäº†å¼‚å¸¸ä¹‹å è‡ªåŠ¨å®ä¾‹åŒ–ç›¸å…³çš„å¼‚å¸¸ç±»
* 2ã€å¦‚æœæ­¤æ—¶ç¨‹åºä¹‹ä¸­æ²¡æœ‰æä¾›å¼‚å¸¸å¤„ç†çš„æ”¯æŒï¼Œåˆ™ä¼šé‡‡ç”¨jvmçš„é»˜è®¤å¼‚å¸¸å¤„ç†ï¼Œé¦–å…ˆè¿›è¡Œå¼‚å¸¸ä¿¡æ¯çš„æ‰“å°ï¼Œè€Œåç›´æ¥é€€å‡ºå½“å‰çš„ç¨‹åºã€‚
* 3ã€ æ­¤æ—¶ç¨‹åºä¸­å¦‚æœå­˜åœ¨æœ‰å¼‚å¸¸å¤„ç†é‚£ä¹ˆè¿™ä¸ªäº§ç”Ÿçš„å¼‚å¸¸ç±»çš„å®ä¾‹åŒ–å¯¹è±¡å°†ä¼šè¢«tryè¯­å¥æ•è·
* 4ã€ tryæ•è·åˆ°å¼‚å¸¸ä¹‹åï¼Œä¸å…¶åŒ¹é…åˆ°çš„catchä¸­çš„å¼‚å¸¸ç±»å‹è¿›è¡Œä¸€æ¬¡æ¯”å¯¹ã€‚
    * å¦‚æœæ­¤æ—¶ä¸catchä¸­çš„æ•è·å¼‚å¸¸ç±»ç›¸åŒï¼Œåˆ™è®¤ä¸ºåº”è¯¥ä½¿ç”¨æ­¤catchè¿›è¡Œå¼‚å¸¸å¤„ç†
    * å¦‚æœä¸åŒ¹é…åç»­è¿˜æœ‰catchè¯­å¥ï¼Œç»§ç»­åŒ¹é…åç»­catchç±»å‹ã€‚å¦‚æœç±³æœ‰åŒ¹é…æˆåŠŸï¼Œåˆ™æ— æ³•è¿›è¡Œå¼‚å¸¸å¤„ç†
* 5ã€ ä¸ç®¡æœ€åæœ‰æ²¡æœ‰å¤„ç†å¼‚å¸¸æˆåŠŸéƒ½æœ€ç»ˆéƒ½è¦æ‰§è¡Œfinallyä¸­çš„è¯­å¥ã€‚
    * å¦‚æœå½“å‰å¼‚å¸¸å¤„ç†è¿‡äº†ï¼Œåˆ™ç»§ç»­å‘åæ‰§è¡Œä»£ç ã€‚
    * å¦‚æœæ²¡æœ‰å¤„ç†ï¼Œåˆ™äº¤ç”±jvmè¿›è¡Œé»˜è®¤å¼‚å¸¸å¤„ç†ã€‚


* å¼‚å¸¸çš„å¤„ç†è¿‡ç¨‹å®é™…ä¸Šæ˜¯å¤„ç†çš„å¼‚å¸¸é”™è¯¯çš„å®ä¾‹åŒ–å¯¹è±¡
    * Throwable
        * Error ï¼š æ­¤æ—¶ç¨‹åºè¿˜æœªæ‰§è¡Œå‡ºç°çš„é”™è¯¯ï¼Œå¼€å‘è€…æ— æ³•å¤„ç†
        * Exception ï¼š ç¨‹åºä¸­å‡ºç°çš„å¼‚å¸¸å¼€å‘è€…å¯ä»¥å¤„ç†ï¼Œåœ¨å¼€å‘ä¹‹ä¸­çœŸæ­£è¦å…³æ³¨çš„å°±æ˜¯Exception

* å¼‚å¸¸äº§ç”Ÿçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿå¼‚å¸¸çš„å®ä¾‹åŒ–å¯¹è±¡ï¼ŒæŒ‰ç…§å¯¹è±¡çš„è½¬æ¢åŸåˆ™ï¼Œå¯ä»¥è‡ªåŠ¨å‘çˆ¶ç±»(Exception)è½¬å‹ã€‚

* ç®€åŒ–å¼‚å¸¸å¤„ç†

```java
public class JavaDemo18 {
    public static void main(String[] args) {
        System.out.println("ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ");
        try {
            int x = Integer.parseInt(args[0]);
            int y = Integer.parseInt(args[1]);
            System.out.println("ã€2ã€‘è®¡ç®—x/y=" + (x / y));
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            System.out.println("æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ");
        }
        System.out.println("ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ");
        // æ— å‚æ•° ä¸‹æ ‡è¶Šç•Œé”™è¯¯ java JavaDemo18
        // ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ
        // java.lang.ArrayIndexOutOfBoundsException: Index 0 out of bounds for length 0
        // at JavaDemo18.main(JavaDemo18.java:5)
        // æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ
        // ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ

        // å‚æ•°ç±»å‹é”™è¯¯ java JavaDemo18 a b 
        // ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ
        // java.lang.NumberFormatException: For input string: "a"
        // at
        // java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
        // at java.base/java.lang.Integer.parseInt(Integer.java:652)
        // at java.base/java.lang.Integer.parseInt(Integer.java:770)
        // at JavaDemo18.main(JavaDemo18.java:5)
        // æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ
        // ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ

        // java JavaDemo18 10 0
        // ã€1ã€‘ç¨‹åºå¼€å§‹æ‰§è¡Œ
        // java.lang.ArithmeticException: / by zero
        // at JavaDemo18.main(JavaDemo18.java:5)
        // æ˜¯å¦å¼‚å¸¸éƒ½æ‰§è¡Œ
        // ã€3ã€‘ç¨‹åºæ‰§è¡Œç»“æŸ
    }
}
```

* åŒæ—¶å¤„ç†å¤šä¸ªå¼‚å¸¸æ—¶ï¼Œè¦æŠŠæ•è·èŒƒå›´å¤§çš„å¼‚å¸¸æ”¾åœ¨æ•è·èŒƒå›´å°çš„å¼‚å¸¸å¤„ç†ä¹‹åã€‚

### throws å…³é”®å­—

* åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å‘Šè¯‰ä½¿ç”¨è€…ï¼Œè¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šäº§ç”Ÿä½•ç§å¼‚å¸¸ã€‚åœ¨æ–¹æ³•å£°æ˜ä¸Šç”¨throwså…³é”®å­—æ ‡æ³¨ä¼šäº§ç”Ÿä½•ç§å¼‚å¸¸ã€‚

* throws æŠ›å‡ºå¼‚å¸¸æ˜¯æƒ³ä¸Šä¸€çº§è°ƒç”¨æŠ›å‡ºå¼‚å¸¸

* ğŸŒ°

```java
class MyMath {
    //è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œå¦‚æœäº§ç”Ÿå¼‚å¸¸è°ƒç”¨å‡ºå¤„ç†
    public static int div(int x, int y) throws Exception {
        return x / y;
    }
}

public class JavaDemo20 {
    public static void main(String[] args) {
        try{
            System.out.println(MyMath.div(10,2));
        }catch(Exception e){
            e.printStackTrace();
        }
    }
}
```

* å¦‚æœä¸»æ–¹æ³•å‘ä¸ŠæŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™äº¤ç”±jvmå¤„ç†

```java
class MyMath {
    //è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œå¦‚æœäº§ç”Ÿå¼‚å¸¸è°ƒç”¨å‡ºå¤„ç†
    public static int div(int x, int y) throws Exception {
        return x / y;
    }
}

public class JavaDemo20 {
    public static void main(String[] args) throws Exception {
            System.out.println(MyMath.div(10,2));
    }
}
```

### throwå…³é”®å­—

* throwçš„ä¸»è¦ä½œç”¨æ˜¯æ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä¸”è¿›è¡Œå¼‚å¸¸çš„æŠ›å‡ºå¤„ç†ã€‚

```java
public class JavaDemo21 {
    public static void main(String[] args) {
        try {
            throw new Exception("æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸");
        } catch (Exception e) {
            e.printStackTrace();
        }
        // java.lang.Exception: æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸
        // at JavaDemo21.main(JavaDemo21.java:4)
    }
}
```

|åŒºåˆ«|throw|throws|
|---|----|----|
|1|åœ¨ä»£ç å—ä¸­ä½¿ç”¨ï¼Œä¸»è¦æ˜¯æ‰‹å·¥å¯¹å¼‚å¸¸çš„æŠ›å‡º|æ–¹æ³•å®šä¹‰ä¸Šä½¿ç”¨çš„ï¼Œè¡¨ç¤ºæ­¤æ–¹æ³•å°†äº§ç”Ÿçš„å¼‚å¸¸æ˜ç¡®å‘Šè¯‰ç»™è°ƒç”¨å‡º,ç”±è°ƒç”¨å‡ºè¿›è¡Œå¤„ç†|

### å¼‚å¸¸å¤„ç†æ¨¡å‹

* tryã€catchã€finallyã€throwsã€throw

* é•¿ç”¨äºåœ¨ä»¥åçš„èµ„æºè®¿é—®ã€‚

```java

class MyMath {
    // è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œå¦‚æœäº§ç”Ÿå¼‚å¸¸è°ƒç”¨å‡ºå¤„ç†
    public static int div(int x, int y) throws Exception {
        int temp = 0;
        System.out.println("è®¡ç®—å¼€å§‹");
        try{
            temp = x / y;
        }finally{
            System.out.println("è®¡ç®—ç»“æŸ");
        }
        return temp;
    }
}

public class JavaDemo20 {
    public static void main(String[] args) throws Exception {
        System.out.println(MyMath.div(10, 0));
    }
}

// æˆ–è€…

class MyMath {
    // è¿™é‡Œå¯èƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œå¦‚æœäº§ç”Ÿå¼‚å¸¸è°ƒç”¨å‡ºå¤„ç†
    public static int div(int x, int y) throws Exception {
        int temp = 0;
        System.out.println("è®¡ç®—å¼€å§‹");
        try {
            temp = x / y;
        } catch (Exception e) {
            throw e; //å‘ä¸ŠæŠ›å‡ºå¼‚å¸¸
        } finally {
            System.out.println("è®¡ç®—ç»“æŸ");
        }
        return temp;
    }
}

public class JavaDemo20 {
    public static void main(String[] args) throws Exception {
        System.out.println(MyMath.div(10, 0));
    }
}

```

### RuntimeException

```java
java.lang.Object
    java.lang.Throwable
        java.lang.Exception
            java.lang.RuntimeException
                java.lang.IllegalArgumentException
                    java.lang.NumberFormatException
```

* æŠ›å‡ºå¼‚å¸¸åä¸å¼ºåˆ¶å¤„ç†ã€‚æä¾›ä¸€ä¸ªçµæ´»çš„å¯é€‰çš„å¼‚å¸¸å¤„ç†çˆ¶ç±»RuntimeException,è¿™ä¸ªç±»çš„å¼‚å¸¸å­ç±»å¯ä»¥ä¸å¼ºåˆ¶å¼‚å¸¸å¤„ç†

* Integer.ParseInt()æ–¹æ³•: public static int parseIntâ€‹(CharSequence s,int beginIndex,int endIndex,int radix) throws NumberFormatException

    * è¿™ä¸ªæ–¹æ³•æ˜ç¡®çš„æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯åœ¨å¤„ç†çš„æ—¶å€™å¹¶æ²¡æœ‰å¼ºåˆ¶æ€§è¦æ±‚å¤„ç†ã€‚

|åŒºåˆ«|Exception|RunTimeException|
|---|---|---|
|1|Exceptionå¿…é¡»å¼ºåˆ¶è¿›è¡Œå¤„ç†|æ˜¯Exceptionçš„å­ç±»ï¼Œå¯ä»¥ä¸å¼ºåˆ¶å¤„ç†å¼‚å¸¸|

### è‡ªå®šä¹‰å¼‚å¸¸ç±»

* å®ç°æ–¹æ¡ˆ
    * ç»§æ‰¿ Exceptionã€RunTimeException

```java

class BombException extends Exception {
    public BombException(String msg) {
        super(msg);
    }
}

class Food {
    public static void eat(int num) throws BombException {
        if (num > 10) {
            throw new BombException("åƒå¤šäº†");
        }
        {
            System.out.println("æ­£å¸¸");
        }
    }
}

public class JavaDemo22 {
    public static void main(String[] args) throws Exception {
        Food.eat(11);
        // Exception in thread "main" BombException: åƒå¤šäº†
        // at Food.eat(JavaDemo22.java:11)
        // at JavaDemo22.main(JavaDemo22.java:21)
    }
}
```

### assertæ–­è¨€

* ä»jdk1.4å¢åŠ æ–­è¨€åŠŸèƒ½

```java
public class JavaDemo23 {
    public static void main(String[] args) {
        int x = 10;
        assert x == 100 : "xçš„å†…å®¹ä¸æ˜¯100";
        System.out.println(x);
        //10
    }
}
```

* è¦æƒ³æ‰§è¡Œæ–­è¨€ï¼Œåˆ™å¿…é¡»åœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™åŠ å…¥å‚æ•° java -ea JavaDemo23

```java
mhc:example mhc$ java -ea  JavaDemo23
Exception in thread "main" java.lang.AssertionError: xçš„å†…å®¹ä¸æ˜¯100
        at JavaDemo23.main(JavaDemo23.java:4)
```

* åœ¨javaé‡Œå¹¶æ²¡æœ‰å°†æ–­è¨€è®¾ç½®ä¸ºå¿…é¡»æ‰§è¡Œçš„æ­¥éª¤ï¼Œéœ€è¦åœ¨ç‰¹å®šç¯å¢ƒä¸‹æ‰æ‰§è¡Œ
